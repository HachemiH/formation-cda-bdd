# 5.3 Création et Gestion des Bases de Données

<blockquote>
    <h2>Prérequis</h2>
    <p>Connaissance basique de PostgreSQL et de la ligne de commande est nécessaire, ainsi que les bases de gestion des utilisateurs, comme expliqué dans la section 5.2.</p>
</blockquote>

<blockquote>
    <h2>Objectifs pédagogiques</h2>
    <ul>
        <li>Apprendre à créer et configurer des bases de données dans PostgreSQL.</li>
        <li>Comprendre comment gérer les propriétés de la base de données, telles que les encodages et les collations.</li>
        <li>Développer des compétences pour effectuer des tâches de maintenance de base, telles que la sauvegarde et la restauration de bases de données.</li>
    </ul>
</blockquote>

---

Dans le monde du développement et de la gestion de bases de données, créer une base de données est tout aussi crucial que de savoir la sauvegarder et la restaurer. Cette section explore non seulement les procédures de création de bases de données dans PostgreSQL, mais met également un fort accent sur les techniques de sauvegarde et de restauration. La mise en place d'un système de sauvegarde automatisé est essentielle pour garantir la sécurité et la durabilité des données. Ces pratiques sont fondamentales pour protéger les informations que les utilisateurs nous confient, en assurant que les données peuvent être récupérées en cas de défaillance système ou de perte de données.


## 5.3.1 Création de Bases de Données

Pour commencer à utiliser PostgreSQL pour gérer des données, vous devez d'abord créer une base de données. PostgreSQL permet de le faire facilement avec la commande `CREATE DATABASE`.

### Exemple de Commande de Création

```sql
CREATE DATABASE ma_base_de_donnees;
```
- **Explication** : Cette commande crée une nouvelle base de données appelée `ma_base_de_donnees` dans PostgreSQL.
- **Traduction** : "Crée une base de données nommée `ma_base_de_donnees`."

### Configuration Initiale

Après la création, vous pouvez ajuster les paramètres de votre base de données pour répondre aux besoins spécifiques de votre application, comme définir l'encodage des caractères ou la collation.

## 5.3.2 Gestion des Propriétés de la Base de Données

Modifier les propriétés d'une base de données peut aider à améliorer les performances et la gestion des données.

### Modification de l'Encodage

```sql
ALTER DATABASE ma_base_de_donnees SET ENCODING = 'UTF8';
```
- **Explication** : Cette commande change l'encodage des caractères de la base de données à UTF8.
- **Traduction** : "Modifie l'encodage de la base de données `ma_base_de_donnees` en UTF8."

## 5.3.3 Maintenance des Bases de Données

La maintenance régulière est nécessaire pour assurer la performance et la sécurité des bases de données.

### Sauvegarde et Restauration manuelle 

Savoir comment sauvegarder et restaurer des bases de données est essentiel pour la récupération après sinistre.

```sql
pg_dump ma_base_de_donnees > backup.sql
```
- **Explication** : Sauvegarde la base de données `ma_base_de_donnees` dans un fichier SQL nommé `backup.sql`.
- **Traduction** : "Effectue une sauvegarde de la base de données nommée `ma_base_de_donnees` dans un fichier que l'on nommera `backup.sql`."

```sql
psql ma_base_de_donnees < backup.sql
```
- **Explication** : Restaure la base de données `ma_base_de_donnees` à partir du fichier de sauvegarde `backup.sql`.
- **Traduction** : "Restaure la base de données `ma_base_de_donnees` à partir du fichier `backup.sql`."


### Automatisation de la Sauvegarde dans Linux

Pour assurer la sécurité et la durabilité des données, l'automatisation des sauvegardes est essentielle. Dans un environnement Linux, cela peut souvent être réalisé en utilisant des tâches cron, qui permettent de planifier des commandes ou des scripts pour qu'ils s'exécutent à des intervalles réguliers.

#### Qu'est-ce qu'un Cron Job?

Un **cron job** est une tâche planifiée dans Unix/Linux qui est exécutée à des moments spécifiés par l'utilisateur. Cron utilise un **crontab** (table de cron), un fichier de configuration qui contient des instructions pour le cron daemon sur les commandes à exécuter et leur programmation.

#### Configuration d'une Tâche Cron pour les Sauvegardes

1. **Ouvrir le Crontab** :
   Pour éditer les tâches cron pour l'utilisateur actuel, utilisez la commande:
   ```bash
   crontab -e
   ```
   Cela ouvrira le fichier crontab de l'utilisateur dans l'éditeur de texte par défaut.

2. **Ajouter une Tâche Cron** :
   Pour planifier une sauvegarde quotidienne de votre base de données à minuit, ajoutez la ligne suivante au crontab :
   ```bash
   0 0 * * * /usr/bin/pg_dump -U postgres ma_base_de_donnees > /chemin/de/sauvegarde/backup_$(date +\%Y\%m\%d).sql
   ```
   - **Explication de la syntaxe Cron** :
     - `0 0 * * *` : Le premier `0` représente la minute, le deuxième `0` l'heure. `* * *` signifie chaque jour de chaque mois, et chaque jour de la semaine.
     - La commande qui suit est exécutée à l'heure spécifiée. Ici, `pg_dump` est utilisé pour sauvegarder la base de données `ma_base_de_donnees`.

- **Traduction de la Commande** :
  - "Programme une sauvegarde quotidienne de la base de données `ma_base_de_donnees` à minuit. Le fichier de sauvegarde sera nommé avec la date courante et stocké dans le chemin spécifié."

#### Avantages de l'Automatisation des Sauvegardes

L'automatisation des sauvegardes via cron assure que vos données sont régulièrement sauvegardées sans intervention manuelle. Cela aide à protéger contre la perte de données en cas de panne système ou d'autres problèmes, en garantissant que les copies de sauvegarde les plus récentes sont toujours disponibles.


## Résumé

- **Création de bases de données** : Utilisation de `CREATE DATABASE` pour initialiser de nouvelles bases de données.
- **Gestion des propriétés** : `ALTER DATABASE` pour modifier les paramètres essentiels comme l'encodage.
- **Maintenance** : Importance de la sauvegarde régulière et des procédures de restauration pour protéger les données.

